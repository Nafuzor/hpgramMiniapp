<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HupGram Core</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        :root {
            --font: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            --bg-1: #e0e5ec; --bg-2: #f5f7fa; --bg-3: #c8d0d8;
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.5);
            --text: #1d1d1f; --text-muted: #86868b;
            --accent: #007aff; --success: #34c759;
            --radius: 24px;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-1: #1c1c1e; --bg-2: #2c2c2e; --bg-3: #000000;
                --glass-bg: rgba(40, 40, 40, 0.65);
                --glass-border: rgba(255, 255, 255, 0.1);
                --text: #f5f5f7; --text-muted: #98989d;
            }
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: var(--font); color: var(--text);
            background: linear-gradient(-45deg, var(--bg-1), var(--bg-2), var(--bg-3));
            background-size: 400% 400%; animation: liquid 15s ease infinite;
            min-height: 100vh; overflow-x: hidden; padding-bottom: 100px;
        }
        @keyframes liquid { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        /* AUTH SCREEN */
        #auth-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-2); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px;
        }
        .auth-card {
            background: var(--glass-bg); padding: 30px; border-radius: 24px;
            width: 100%; max-width: 320px; text-align: center;
            border: 1px solid var(--glass-border); box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        input {
            width: 100%; padding: 14px; margin: 8px 0; border-radius: 12px;
            border: 1px solid var(--glass-border); background: rgba(128,128,128,0.1);
            color: var(--text); font-size: 16px; outline: none; text-align: center;
        }
        .btn-primary {
            width: 100%; padding: 14px; margin-top: 10px; border-radius: 12px;
            background: var(--accent); color: white; border: none; font-size: 16px; font-weight: 600;
            cursor: pointer; transition: 0.2s;
        }

        /* MAIN APP */
        #main-app { display: none; }
        .view { display: none; padding: 20px; max-width: 600px; margin: 0 auto; animation: fadeIn 0.4s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--glass-bg); backdrop-filter: blur(20px); border: 1px solid var(--glass-border);
            border-radius: var(--radius); padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        .title { font-size: 13px; font-weight: 600; text-transform: uppercase; color: var(--text-muted); margin: 0 0 10px 15px; }

        /* NAVBAR */
        .navbar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 350px; height: 65px;
            background: var(--glass-bg); backdrop-filter: blur(20px);
            border-radius: 35px; border: 1px solid var(--glass-border);
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); z-index: 100;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px; color: var(--text-muted); cursor: pointer; transition: 0.3s; width: 60px; }
        .nav-item i { width: 22px; height: 22px; }
        .nav-item.active { color: var(--accent); transform: translateY(-2px); }
        
        .mod-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid rgba(128,128,128,0.1); }
        .mod-item:last-child { border-bottom: none; }
        .console-out { font-family: monospace; font-size: 12px; height: 250px; overflow-y: auto; margin-bottom: 15px; border: 1px solid rgba(128,128,128,0.1); border-radius: 12px; padding: 10px; }
    </style>
</head>
<body>

    <!-- AUTH SCREEN -->
    <div id="auth-screen">
        <div class="auth-card">
            <h2 style="margin-bottom: 5px;">HupGram Web</h2>
            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 20px;">Введите логин и пароль из бота</p>
            <input type="text" id="login-id" placeholder="ID (Логин)" disabled>
            <input type="password" id="login-pass" placeholder="Ваш пароль">
            <button class="btn-primary" onclick="tryLogin()">Подключиться</button>
            <p id="auth-err" style="color: #ff3b30; font-size: 12px; margin-top: 10px; display: none;">Данные отправлены боту. Если пароль верный, интерфейс загрузится.</p>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="main-app">
        <!-- DASHBOARD -->
        <div id="tab-dash" class="view active">
            <div class="card" style="display: flex; align-items: center; gap: 15px;">
                <div style="width: 50px; height: 50px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 700; font-size: 20px;">U</div>
                <div>
                    <h2 style="font-size: 18px;" id="u-name">User</h2>
                    <p style="font-size: 13px; color: var(--text-muted);">Web Mode Active</p>
                </div>
            </div>

            <div class="title">Статистика</div>
            <div class="card"><canvas id="activityChart" style="height: 180px; width: 100%;"></canvas></div>
        </div>

        <!-- MODULES -->
        <div id="tab-mods" class="view">
            <div class="title">Управление защитой</div>
            <div class="card" id="modules-list"></div>
        </div>

        <!-- CONSOLE -->
        <div id="tab-term" class="view">
            <div class="title">Терминал</div>
            <div class="card">
                <div class="console-out" id="term-log">
                    <div>[System] Ready.</div>
                    <div>Type <b>.id</b> to generate API Key.</div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="term-in" style="margin: 0; text-align: left; font-family: monospace;" placeholder="...">
                    <button class="btn-primary" style="width: auto; padding: 0 20px;" onclick="runCmd()"><i data-feather="arrow-right"></i></button>
                </div>
            </div>
        </div>

        <!-- APP SETTINGS -->
        <div id="tab-settings" class="view">
            <div class="title">Авторизация Юзербота</div>
            <div class="card">
                <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 15px;">Введите данные от my.telegram.org</p>
                <input type="number" id="api_id" placeholder="API ID (Только цифры)">
                <input type="text" id="api_hash" placeholder="API HASH (Строка)">
                <input type="text" id="api_phone" placeholder="Номер телефона (+7...)">
                <button class="btn-primary" onclick="sendAuthData()">Подключить Аккаунт</button>
            </div>
        </div>
    </div>

    <!-- NAVBAR -->
    <div class="navbar" id="navbar" style="display: none;">
        <div class="nav-item active" onclick="go('dash', this)"><i data-feather="grid"></i></div>
        <div class="nav-item" onclick="go('mods', this)"><i data-feather="layers"></i></div>
        <div class="nav-item" onclick="go('term', this)"><i data-feather="terminal"></i></div>
        <div class="nav-item" onclick="go('settings', this)"><i data-feather="settings"></i></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); feather.replace();

        const user = tg.initDataUnsafe.user || { id: 0, first_name: "Guest" };
        document.getElementById('login-id').value = user.id;
        document.getElementById('u-name').innerText = user.first_name;

        // AUTHENTICATION
        function tryLogin() {
            const pass = document.getElementById('login-pass').value;
            if(pass.length < 4) return;
            
            // В реальной интеграции мы отправим боту данные для проверки
            // Сейчас для демонстрации просто пускаем (мы добавим проверку в боте)
            tg.sendData(JSON.stringify({action: "login", password: pass}));
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            document.getElementById('navbar').style.display = 'flex';
            tg.HapticFeedback.notificationOccurred('success');
        }

        // AUTO-LOGIN IF OPENED FROM BOT ALREADY LOGGED IN
        // (Мы передадим флаг через URL, но пока просто скрываем)

        // MODULES (Visual Only)
        const modules = ['Антивирус', 'Автоответ', 'Скрытность', 'Спаммер'];
        const mList = document.getElementById('modules-list');
        modules.forEach(m => {
            mList.innerHTML += `<div class="mod-item"><b>${m}</b><span style="color:#34c759">ВКЛ</span></div>`;
        });

        // CONSOLE
        function runCmd() {
            const inp = document.getElementById('term-in');
            const log = document.getElementById('term-log');
            const cmd = inp.value.trim();
            if(!cmd) return;

            log.innerHTML += `<div>> ${cmd}</div>`;
            if(cmd === '.id') {
                const key = `HG-${user.id}-${Math.floor(Math.random()*9000)+1000}`;
                log.innerHTML += `<div style="color:var(--success)">KEY: ${key}</div>`;
                tg.sendData(JSON.stringify({action: 'key', value: key}));
            }
            inp.value = '';
            log.scrollTop = log.scrollHeight;
        }

        // SEND AUTH DATA TO BOT
        function sendAuthData() {
            const id = document.getElementById('api_id').value;
            const hash = document.getElementById('api_hash').value;
            const phone = document.getElementById('api_phone').value;
            
            if(!id || !hash || !phone) return tg.showAlert("Заполните все поля!");
            
            tg.sendData(JSON.stringify({
                action: 'web_auth_submit',
                api_id: id,
                api_hash: hash,
                phone: phone
            }));
            tg.HapticFeedback.notificationOccurred('success');
            tg.showAlert("Данные отправлены боту. Проверьте чат с ботом для ввода кода.");
        }

        function go(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('tab-' + id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }

        // CHART
        const ctx = document.getElementById('activityChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: { labels: ['1','2','3','4','5','6','7'], datasets: [{ data: [10,20,15,30,25,40,35], borderColor: '#007aff', tension: 0.4 }] },
            options: { plugins: {legend: {display: false}}, scales: {x: {display: false}, y: {display: false}} }
        });
    </script>
</body>
</html>
